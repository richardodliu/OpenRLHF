## 更新计划：在 TRM 主风格下系统迁移 DPPO 的“可用理论模块”（优先 1+2，同时纳入其它有用结论；重复/矛盾严格禁止）

### 新增目标（在你上一版 plan 的基础上升级）

在不改变 REINFORCE Pro Max 核心方法与科学逻辑的前提下，尽可能吸收 DPPO 中对我们论文结论“真的有用”的数学结果，并把它们组织成：

- 正文：必要的定义与承重结论（statement-only），用于支撑我们的论证链条；
- 附录：DPPO 风格的细证明（但 proof 语言与排版尽量 TRM 化）；
- 对于“只是背景但不影响我们主线”的结果：允许放附录（或附录+一句正文引用），但必须满足“不重复、不矛盾”。

———

## 0. 硬约束（本计划中的全程门禁）

- 禁止重复：凡是 TRM 或我们草稿中已经存在“同等强度、同等假设、同等结论”的定理/引理/命题，不再以新 theorem/proposition 形式出现。
- 禁止矛盾：凡是 DPPO 与 TRM/我们草稿在同一假设下结论冲突的表述，必须删除或改成“条件化/局限性说明”。
- 禁止“只换符号”的搬运：DPPO 结论若完全等价且我们不需要其结构性作用，则不引入；若其 proof 技巧能显著改进我们已有证明，则用来重写我们 proof，但不新增定理。
- 贡献归属清晰：迁移部分必须明确标注 “adapted from / following DPPO” 并引用；我们自己的延伸推论明确用 “we further derive”。

———

## 1. Phase 1 — DPPO 可迁移结果的全量盘点与去重分类（输出“迁移清单”）

### 1.1 扫描范围（DPPO）

- tex/literature/DPPO/paper/background.tex
- tex/literature/DPPO/paper/llm_bound.tex
- tex/literature/DPPO/paper/method.tex
- tex/literature/DPPO/paper/app.tex
- 交叉对照 TRM：tex/literature/TRM/main_arxiv.tex
- 交叉对照我们草稿：tex/main/3-preliminaries.tex, tex/main/4-method.tex, tex/main/5-theory.tex, tex/main/appendix.tex

### 1.2 分类标准（必须 decision-complete）

对每个 DPPO 结果（lemma/theorem/identity/关键推导），判定为以下三类之一：

1. Class U（Unique & Useful，可新增）
    - TRM/我们草稿中没有同等结论；
    - 能直接支撑我们对 mismatch、proxy、mask、prefix 因果结构、或 error decomposition 的论证；
    - 或能导出一个我们自己的“prefix/causal extension”。
2. Class O（Overlapping，可用于重写，不新增）
    - 与 TRM/我们已有结论等价或强烈重叠；
    - 但 DPPO 的 proof 结构/技巧（如 telescoping identity、TV chain bound）能让我们现有 proof 更清晰、更 TRM/DPPO 化；
    - 处理方式：用 DPPO 的 proof 技巧改写我们的附录证明或 remark 解释，但不新增 theorem。
3. Class C（Conflicting / Risky，禁止出现）
    - 与 TRM/我们草稿在相同设置下结论冲突，或引入会误导读者的暗含假设；
    - 处理方式：完全不引入；必要时在 related work/remark 里只陈述“DPPO 在其设定下…”并强调条件，不给公式级断言。

### 1.3 迁移清单输出格式（实现阶段的 TODO）

每条结果记录：

- DPPO 原位置（文件 + section/label）
- 结果类型（Identity / Lemma / Theorem / Proof technique）
- 归类（U/O/C）
- 我们论文落点（Preliminaries / Unified Framework / Appendix）
- 作用（支撑哪一段、承重哪一条推导、或导出哪个我们的新推论）
- 是否需要“prefix/causal extension”（是/否；如果是，写出 extension 的目标结论形式）

———

## 2. 优先迁移：DPPO 的 1+2（强制纳入主链路）

> 这部分不变：仍然是你明确指定的最高优先级。

### 2.1 (DPPO-2) TV 与 ratio 的期望恒等式（statement in正文 + proof in附录）

- 放置：tex/main/3-preliminaries.tex 新增一个小节 Divergence Proxies from Sampled Tokens
- 附录：tex/main/appendix.tex 给完整 proof（TRM 风格 step-by-step align）
- 我们自己的延伸（必须有，避免“只换符号”）：
    - 给一个桥接 lemma：在可验证条件下把我们使用的 log-ratio / prefix geometric mean proxy 与 (|\rho_t-1|) 形式联系起来（明确条件、明确不等式链、附录证
    明）。

### 2.2 (DPPO-1) Partition divergence lower bound（TV 与 KL，两条线）

- 放置：Preliminaries 中给 general partition lemma；Binary/Top-K 作为 corollary（不强调 DPPO 的算法，只强调数学事实）
- 附录：给 triangle inequality（TV）与 log-sum inequality（KL）的完整 proof
- 我们自己的延伸（必须有）：
    - 给一个“sampled-token binary lower bound 与 ratio 的等价表达”推论，作为我们后续解释“ratio 大不代表 divergence 大”的数学入口；
    - 再给一个“prefix aggregation”推论：把 per-step lower bound 沿 prefix 聚合，得到一个可用于解释 prefix drift 的 proxy family（仍强调下界/局限，不声称等
    价 TRM max-KL）。

———

## 3. DPPO 除 1+2 外的“可迁移结果池”（更新 plan 的新增部分）

下面列出 DPPO 中我们已经在材料里看到、且可能对我们论文结论有用的其它结果。每条都给“默认落点”和“去重策略”。

### 3.1 LLM regime 的 Performance Difference Identity 与 Policy Improvement Bound（来自 llm_bound.tex）

- DPPO 内容：
    - Theorem: LLM 版 performance difference identity（引入 (\Delta(\mu,\pi)) 的误差项分解）
    - Theorem: policy improvement bound（一个 (O(T^2)) 的 max-TV 型 bound）
- 去重与风险：
    - TRM 已经有更系统的 error decomposition 与多条 bound family；我们草稿也有 error decomposition（(|\mathrm{Error}|) 的 per-position factorization）。
    - 结论层面很可能 Class O（重叠）。
- 计划处理（默认）：
    - 不新增 theorem，避免重复。
    - 作为 Proof technique：把 DPPO 的 telescoping / tower property 组织方式用于改写我们已有 error decomposition 解释，使之更像 DPPO/TRM 的严谨叙事。
    - 若 DPPO 的 identity 能导出我们草稿中缺失的“等式级别解释”（例如把某个 error 写成显式 (\Delta) 的形式以帮助讨论 proxy/gating 的位置），允许在附录加入
    一个 Remark（不是定理）：
        - 明确写成 “alternative exact decomposition (following DPPO)”，并注明与我们主符号 (\mathcal{L}_{\piroll}) 的关系。
    - 若发现该 identity 在我们的设定（token-level expansion, prefix gating）能自然导出一个新的、与 prefix causal mask 直接相关的推论（例如把 future-
    trajectory TV 的界写成前缀条件形式），则升级为 Class U，但必须是“延伸版”，不是原样搬运。

### 3.2 Lemma：Sequence-level TV divergence 被 per-step TV 期望和上界（来自 app.tex 的 lem:sequence_tv_bound）

- DPPO Lemma（关键）：对序列分布的 TV 距离有
[
D_{\mathrm{TV}}(P_N|Q_N) \le \sum_{t=1}^N \mathbb{E}{s_t\sim \pi{\mathrm{roll}}}\big[D_{\mathrm{TV}}(\pi_{\mathrm{roll}}(\cdot|s_t)|\pi_\theta(\cdot|
s_t))\big].
]
- 这条在 TRM 主文里不一定以 TV chain lemma 的形式出现（TRM更强调多 route bounds 与 adaptive structure），因此很可能 Class U（Unique & Useful）。
- 我们计划如何用它（确保“有用”而非装饰）：
    1. 在附录 proofs 中把它作为 supporting lemma（给完整 proof，TRM proof aesthetics）。
    2. 在正文 Unified Framework 中实质使用一次：用它把“sequence-level drift”与“per-position divergence budget”联系起来，从而解释：
        - 为什么 TRM 的 sequence rejection 与 per-position drift 累积一致；
        - 为什么我们的 prefix gate 作为“前缀累计 proxy”在结构上更接近这种分解（因果方向一致）。
- 去重检查：
    - 如果我们草稿或 TRM 已有等价 lemma（同样的不等式与假设），则归类为 Class O，只用于 proof rewriting，不新增 lemma。

### 3.3 DPPO 的 composite bound 思路：quadratic max-TV^2 bound 与 linear expected-sum-TV bound 取 min（来自 app.tex tighter bound 部分）

- DPPO 在附录里把 error bound 做了 “min(quadratic, linear)” 的组合，强调更鲁棒。
- 这与 TRM “unified bound family / adaptive bound” 思想高度相近，存在重复风险。
- 计划处理（默认 Class O）：
    - 不引入新定理；在我们论文中已经引用 TRM adaptive bound 的地方，把“DPPO 也有类似 min-of-bounds 的组合”作为一个简短 remark（不带新公式或只带一行公
    式），且明确写 “conceptually consistent with TRM’s unified view”。
    - 只有当我们能把该 composite bound 明确地接入我们的 prefix mask 定理（例如提供一个可引用的 upper bound 结构，帮助解释 prefix thresholding 的合理性），
    且与 TRM 不重复时，才允许作为 Class U 推论加入附录。

### 3.4 “Gradient correspondence”推导：LLM surrogate 与 classical surrogate 的梯度形式类比（来自 app:compare_classical_rl）

- 这是解释性推导，不是核心新结论，但可用于提升论文“学术严谨表达”。
- 计划处理（低优先级，默认放附录）：
    - 作为附录的一个短节：说明我们使用的 surrogate（(\mathcal{L}{\piroll}) / (\tilde{\mathcal{L}}{\piroll})）与 policy gradient 的关系；
    - 重点是澄清“implementation surrogate vs per-step surrogate”差异，避免读者误解（这对我们论文 rigor 有帮助）。
- 去重检查：
    - 如果我们草稿已在 preliminaries remark 里充分讲清楚，则不再加入（避免重复），只在必要处引用 DPPO/PG intro 文献。

### 3.5 DPPO 的“trust region anchor”与 mismatch 讨论（来自 related/mismatch）

- 我们草稿附录 app:mismatch 已经引用并讨论 “rollout-time anchoring”。
- 计划处理（默认不新增）：
    - 仅把 DPPO 作为额外引用来源补强（citation-level），不新增新的数学命题，避免重复。

### 3.6 DPPO 的“divergence approximation gap / equality condition”分析（来自 divergence lower bounds 部分）

- 这部分不是必须，但可以提高附录的完整性。
- 计划处理（低优先级，附录-only）：
    - 以 remark 形式列出 TV/KL 下界取等条件；
    - 只在我们论文中需要讨论“下界有多紧”时引用一次，否则不引入，避免冗余。

———

## 4. 结构落点（保证“正文讲结论，附录讲细节”，且不重复）

### 4.1 tex/main/3-preliminaries.tex

新增一个严谨但克制的小节（建议标题）：

- \subsection{Divergence Proxies and Coarse-Grained Lower Bounds}
内容包含：
- DPPO-2 identity 的 lemma（statement）
- DPPO-1 partition lower bound lemma（statement）
- （如通过去重检查）sequence-level TV chain lemma 的 statement（若判定为 Class U；否则仅在附录出现并从正文引用）
- 每条都用一句桥接文本说明“我们将在哪里使用它”，并指向附录 proof 入口

### 4.2 tex/main/5-theory.tex（Unified Framework）

- 在 IS comparison 中加入“实质使用”段落（必须做到可验收）：
    - 用 TV identity 解释 ratio clipping 的统计学定位（single-sample proxy vs expectation）
    - 用 partition lower bound 解释 divergence proxy 的可计算性与局限
    - 用 sequence-TV chain lemma（若引入）把 sequence drift 与 per-position budget 关联，并衔接到 prefix causal gate 的动机

### 4.3 tex/main/appendix.tex

新增一个 DPPO-aligned proofs 区域（标题示例）：

- \section{Supporting Lemmas Adapted from DPPO}
子节包含：

1. Proof of TV identity
2. Proof of partition TV/KL lower bounds（general partition）
3. Proof (or relocation) of sequence-level TV bound lemma（若 Class U）
4. 我们自己的延伸推论（prefix aggregation / bridge inequalities）的 proof
5. 可选：equality conditions / approximation gap（remark-level）

## 5. 去重与矛盾扫描（实现阶段的强制步骤）
在引入任何 DPPO 结果前，必须跑两轮检查：

1. 重复检查（statement-level）
- 若等价：归类 Class O，仅用于改写 proof，不新增 lemma/theorem。

2. 矛盾检查（assumption-level）

- 明确写出每个 DPPO 结论的假设（有限长度、support、reward bound、是否 on-policy/off-policy）
- 与我们 paper 的设定不一致时：
    - 要么补足条件；
    - 要么改为 remark 并强调“DPPO setting differs”。

———

## 6. 验收标准（新增条款）

- DPPO 除 1+2 外的新增内容，至少满足：
    - lem:sequence_tv_bound（或等价版本）在正文被实际用到一次；若未用到，则不应进入正文，仅可作为附录备忘并从正文删除引用。
- 全文不出现“相同结论两个版本”（例如 TRM 与 DPPO 的同一 bound 同时以 theorem 形式出现）。
- PUSH=0 ./compile.sh 必须通过。

———

## 7. 提交策略（实现阶段）

在原有 commit 切分基础上，新增 1 个“DPPO extras”commit：

1. tex: add DPPO proxy lemmas (1+2) and unique supporting lemmas (statements only)
2. tex: add DPPO-style proofs and nontrivial prefix extensions in appendix

每个 commit 后 compile gate 通过。
## 更新计划：在 TRM 主风格下“吸收并延伸 DPPO 的数学结果”，提高数学含量（优先迁移 1+2，并且做可证明的延伸而非复述）

### 你新增的硬要求（我按此锁定）

- 优先迁移 DPPO 中对我们论文结论有用的全部结果，尤其是：
    1. Binary/Top-K（更一般的 partition）divergence 是真 divergence 的下界（TV/KL 两条线，各自有严格证明）。
    2. TV 与 ratio 的期望恒等式：(D_{\mathrm{TV}}(\pi_{\mathrm{roll}}(\cdot|c_t)|\pi_\theta(\cdot|c_t)) = \tfrac12 \mathbb{E}{y_t\sim \pi{\mathrm{roll}}}
        [|\rho_t-1|])（及其解释：PPO clipping 在单样本上硬约束，偏离真 divergence）。
- “完全一样、仅换符号”的结论不放：所有迁移内容必须满足至少一条：
    - 作为我们论文中后续定理链路的“承重 lemma”，并且与我们设置（(\gamma=1)、序列 reward、prefix gate、off-policy mismatch）发生非平凡耦合；
    - 或者给出我们自己的延伸版本（例如 prefix/trajectory 级别、因果结构下的版本，或与我们 mask/statistic 组合后的新推论）。
- DPPO 风格组织：正文保留“定理陈述 + 关键解释 + 入口”，细证明集中放附录（但证明语言仍以 TRM 为主）。

———

## 总体执行策略（不改核心方法，但显著增强理论支撑）

我们不把 DPPO 的结果包装成新贡献，而是以 “Background / Supporting Lemmas” 的方式引入；随后给出与 REINFORCE Pro（prefix gate）直接相关的延伸推论，让这些
lemma 在我们的理论链条里发挥实质作用，而不是装饰。

———

## A. Phase 1 — DPPO 可迁移结果全量盘点（只做“有用且可接入我们链路”的）

### A.1 读取范围（DPPO）

- tex/literature/DPPO/paper/background.tex
- tex/literature/DPPO/paper/llm_bound.tex
- tex/literature/DPPO/paper/method.tex
- tex/literature/DPPO/paper/app.tex
- 同时交叉检查 TRM 对应位置：tex/literature/TRM/main_arxiv.tex（避免重复已有结论）。

### A.2 产出一张“可迁移结果表”（实现阶段的工作清单）

每条结果记录：

- 结果名（Lemma/Theorem/Identity）
- DPPO 原文位置（文件+section）
- 我们论文落点（Preliminaries / Unified / Appendix）
- 是否为“直接引用”还是“我们扩展版本”
- 与我们贡献的连接点（必须写清楚：用于解释哪一段、支撑哪一定理、或导出哪个推论）

优先级排序（你指定 1+2 最高）：

1. Partition divergence lower bound（TV + KL）
2. (D_{\mathrm{TV}}) 与 (\mathbb{E}|\rho-1|) 的恒等式
3. 其它对我们“prefix causal filtering + mismatch”有帮助的 DPPO 结果（例如 LLM regime 的 performance difference identity，如与我们已有 error decomposition
    重叠则只保留延伸版）

———

## B. Phase 2 — 设计“不是复述”的延伸：把 DPPO 结果真正接到我们的 prefix 理论上

> 这一部分是更新计划的核心：我们要把 DPPO 的数学工具转化成“对我们结论有用”的推论或变体。

### B.1 对 DPPO(2) TV-ratio identity 的延伸（从 token 分布到 prefix/因果结构）

**目标：**把
[
D_{\mathrm{TV}}(\pi_{\mathrm{roll}}(\cdot|c_t)|\pi_\theta(\cdot|c_t))
= \tfrac12 \mathbb{E}{y_t\sim \pi{\mathrm{roll}}(\cdot|c_t)}[|\rho_t-1|]
]
从“单步恒等式”变成我们论文里可复用的“因果结构解释工具”。

我们将新增（至少）两条“非平凡”推论（示意，具体表述以实现时严格推导为准）：

1. Corollary（单样本 proxy 的偏差机制）
    说明 IcePop/TIS 对 (|\rho_t-1|) 的单点截断并不等价于控制真实 (D_{\mathrm{TV}})，并明确写成：
    - 单样本约束 ( |\rho_t-1|\le \varepsilon) 是对期望的粗糙 surrogate；
    - prefix-level gate 本质上是在做“前缀平均 log-ratio”的单样本控制，仍然是 proxy，但比 token-level 更符合因果传播。
2. Prefix 级别的“累积 proxy”桥接
    利用我们已有的 prefix 统计量 (\log \rho_s) 与 DPPO 的 (|\rho-1|) 视角，给出一个清晰的“桥接 lemma”：
    - 在一段明确条件下（例如 (\rho_s) 被上下界夹住，或 (|\log\rho_s|) 小），将 prefix 平均 log-ratio 控制转化为对 prefix 平均 (|\rho_s-1|) 的控制（从而与
    TV identity 在语义上对齐）。
    这条 lemma 不能是空话，必须写成可证明的不等式链，并在附录给 proof。

> 结果：读者会清楚我们 gate 在“ratio space”里做事，但它与 divergence 的关系是什么、在哪些条件下能解释为 trust-region proxy。

### B.2 对 DPPO(1) Partition lower bound 的延伸（与我们“只用 sampled token logprob”的现实约束对齐）

DPPO 的证明给出了一个一般事实：对任意 vocabulary partition (\mathcal{C})，在 coarse-graining 后计算的 divergence 是真 divergence 的下界（TV 用 triangle
inequality，KL 用 log-sum inequality）。

我们将把它升级为“对我们论文有用”的形式：

1. Lemma（Partition TV/KL lower bound，general form）
    用我们符号写出一般版，并把 Binary/Top-K 当作 corollary（不止复述，而是作为后续推论的母 lemma）。
2. Corollary（Sampled-token Binary proxy 可计算且是下界）
    以 partition ({y_t, \text{other}}) 为例，得到：
    - (D_{\mathrm{TV}}(\pi_{\mathrm{roll}}(\cdot|c_t)|\pi_\theta(\cdot|c_t)) \ge |\pi_{\mathrm{roll}}(y_t|c_t)-\pi_\theta(y_t|c_t)|)
    - 同时写出其与 ratio 的关系：(|\pi_{\mathrm{roll}}(y_t|c_t)-\pi_\theta(y_t|c_t)| = \pi_{\mathrm{roll}}(y_t|c_t),|\rho_t-1|)
    这一步会直接服务于我们论文中对“低概率 token 的 ratio 很大但 TV 贡献可能很小”的更严谨解释（比纯文字更像 DPPO/TRM）。
3. Prefix 版本的扩展（我们自己的增量）
    给出一个“prefix cumulative”层面的推论：将每步的 binary lower bound 沿 prefix 聚合（例如求和或求均值），得到一个对“prefix drift”的可解释 proxy。
    - 注意：这里不会宣称它等价于 TRM 的 (\max_t D_{\mathrm{KL}})，而是明确作为可计算的 lower bound family，并解释其局限。

> 结果：我们论文能在“不改变核心方法仍用 ratio/prefix proxy”的前提下，引入 DPPO 的数学工具，让审稿人觉得理论链条更硬。

———

## C. Phase 3 — 落地到我们论文的具体结构（正文放结论，附录放证明）

### C.1 在 tex/main/3-preliminaries.tex 增加一个新的“Building Blocks”小节（只放定义与定理陈述）

新增（拟）子小节：

- \subsection{Divergence Proxies from Sampled Tokens}（标题最终按 TRM 风格 Title Case）
内容只包含：
- 一般 partition divergence lower bound 的 lemma（陈述）
- TV identity 的 lemma（陈述）
- 一段非常短的桥接解释：这些结果用于解释 PPO/IS correction 的“单样本 proxy vs 真 divergence”差别，并作为我们 prefix gate 的理论语义背景
- 证明入口：统一引用到 Appendix 对应小节

同时执行你之前的结构要求：

- Existing IS Correction Methods 只保留定义，所有比较挪到 unified framework（你当前已经基本满足，这里继续保持）。

### C.2 在 tex/main/5-theory.tex（Unified Framework）中“使用这些 lemma”，而不是只引用

在 Comparison with Other IS Correction Methods 中新增一个短段落：

- 用 TV identity 一句话说明为何 ratio clipping 是 noisy single-sample estimate 的硬阈值；
- 用 partition lower bound 一句话说明 binary/top-k divergence 是 principled proxies（下界），从而与 TRM/DPPO 的 divergence gating 形成统一谱系；
- 最后回到我们的贡献：我们依然只用 logprob 构造 prefix ratio proxy，但因果结构更一致。

### C.3 在 tex/main/appendix.tex 增加一个完整“DPPO-style lemmas”证明区（TRM 风格 proof）

新增（拟）附录结构：

- \section{Divergence Proxies and Lower Bounds}（或按现有 roadmap 归类到 proofs）
包含：

1. Proof: TV identity（用 TRM 的 step-by-step align 推导，尽量避免 DPPO 原文措辞重复）
2. Proof: partition TV lower bound（triangle inequality，按 partition 求和）
3. Proof: partition KL lower bound（log-sum inequality，逐步展开）
4. 我们的延伸 lemma 的 proof（prefix/average 的桥接不等式，确保不是“只改符号”的重复）



## D. 反抄袭与正确性控制（你之前的总要求在这里仍然生效）

- 对于“与 DPPO/TRM 完全一致”的命题：不放在正文 theorem/proposition；最多作为 remark + cite + proof pointer（或仅附录收录作为 background lemma）。
- 对于“与 DPPO/TRM 结论矛盾”的表述：必须删除或改写，并给出严格条件（如果能修成条件化命题）。
- 所有新增结果必须通过以下自检：
    - 每个不等式写清楚使用了哪个标准工具（triangle, Jensen, log-sum, Pinsker 等）
    - 每个符号在首次出现处有定义（或宏）

    - \textbf{Step k: ...} 或 \textbf{Bound k: ...} 的组织
    - 推导用 align，每行一句，解释短语不夹杂长公式

———

## 提交策略（实现阶段）

建议新增 2 个 commit（在既有 4 个 commit 结构里插入）：

1. tex: add DPPO-style divergence proxy lemmas (statements)
    - 改 tex/main/3-preliminaries.tex, tex/math.tex（必要宏）, 轻量改 tex/main/5-theory.tex 引用
2. tex: add DPPO-style proofs and prefix extensions in appendix
    - 改 tex/main/appendix.tex 为主

每个 commit 后都跑 PUSH=0 ./compile.sh 作为闸门。

———

## 已锁定选择（根据你最新消息更新）

- 迁移重点：DPPO 的 1+2 全覆盖，并且优先级最高。
- 放置位置：正文只放“陈述 + 用途 + 指向附录”；证明细节集中附录（DPPO 风格），证明语言按 TRM。
- 非复述要求：对每个 DPPO 结果至少配一个“与我们 prefix gate 直接相关的推论/桥接 lemma”，避免“只是搬运”。